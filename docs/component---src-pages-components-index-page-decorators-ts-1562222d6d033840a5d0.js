(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{140:function(t,e,n){"use strict";n.r(e);n(34),n(51),n(83),n(77),n(50),n(76),n(178);var o=n(158),r=n(333),i=n(9),a=n(615),s=n(618),c=n(616),u=n(314),f=n(617),g=n(598),b=(n(49),n(308)),h=n.n(b),l=n(597),v=n(613),d=n(619),p=n(620),m=n(611),w=n(612),O=n(614);n(174);n(309),n(310),n(311),n(167);var j=n(312),S=n.n(j),y=function(){function t(t){this.station=void 0,this.station=t}return t.prototype.toString=function(){return this.isValid?"["+this.station.number+"] "+this.station.name+" ("+this.station.bikes+" | "+this.station.free+")":"INVALID"},S()(t,[{key:"isValid",get:function(){return[Number.isInteger(this.station.bikes),Number.isInteger(this.station.free),Number.isInteger(this.station.total),Number.isInteger(this.station.number),this.station.number>0,Number.isFinite(this.station.lat),0!==this.station.lat,Number.isFinite(this.station.lng),0!==this.station.lng,/^\w/.test(this.station.name),0===this.station.errors.length].every(function(t){return t})}}]),t}();n(210),n(313);function N(t){var e=function(t){return void 0===t&&(t={}),Object.assign({data:null,errors:[],bikes:0,free:0,lat:0,lng:0,name:"",number:0,operative:!1,total:0},t)}({data:t,bikes:t.avl_bikes,free:t.free_slots,operative:t.operative,total:t.total_slots});return function(t,e){var n=t.name;try{var o=/^(\d+)\s+(.*)$/.exec(n);if(!o)throw new Error('Unable to parse "number name" from '+n);e.number=Number(o[1]),e.name=o[2]}catch(t){e.errors.push(t)}}(t,e),function(t,e){try{var n=/^\s*(-?\d+\.\d+)\s*,\s*(-?\d+\.\d+)\s*$/.exec(t);if(!n)throw new Error('Unable to parse "lat, lng" from '+t);e.lat=Number(n[1]),e.lng=Number(n[2])}catch(t){e.errors.push(t)}}(t.coordinates,e),e}var k,E=Object(u.a)(function(t){return t.result.map(N)});!function(t){t[t.Smoove=0]="Smoove"}(k||(k={}));var I=new Map([["test",{location:{lat:49.279627,lng:-123.121116},name:"Test Data",type:"Smoove",uri:"/static_data"}],["vancouver",{location:{lat:49.279627,lng:-123.121116},name:"Mobi Bike Vancouver",type:"Smoove",uri:"http://vancouver-ca.smoove.pro/api-public/stations",cors:!0}]]);var P=function(){function t(t,e,n){void 0===n&&(n=!1),this.config=void 0,this.verboseOutput=void 0,this.transform=void 0,this.config=t,this.transform=e,this.verboseOutput=n}t.create=function(e,n){var o=n.debug,r="string"==typeof e?function(t){var e=I.get(t.toLowerCase());if(!e)throw new Error("No station data for source '"+t+"'");return e}(e):e;return new t(r,function(t){var e=t.type;switch(e){case"Smoove":return E;default:throw new Error("Invalid Configuration '"+e+"'")}}(r),o)},t.nearest=function(e,n){return t.create(function(t){return Array.from(I.values()).map(function(e){return{config:e,distance:google.maps.geometry.spherical.computeDistanceBetween(t,new google.maps.LatLng(e.location.lat,e.location.lng))}}).sort(function(t,e){return t.distance-e.distance})[0].config}(e),n)};var e=t.prototype;return e.getJSON=function(){var t=this.config.cors?"https://cors.io/?"+this.config.uri:this.config.uri;this.debug("Fetching stations from '"+t+"' ...");var e=this.config.options?this.config.options.headers:void 0;return p.a.getJSON(t,e)},e.getStations=function(t){var e=this;return(t||this.getJSON()).pipe(Object(m.a)(function(t){e.debug("Fetch Response",t)}),this.transform,Object(u.a)(function(t){return e.debug("Fetched "+t.length+" stations"),{config:e.config,nodes:t.map(function(t){return new y(t)}),fetchedAt:h()()}}),Object(w.a)(function(t){return void 0===t&&(t={}),e.debug("Fetch failed: "+(t.message||"Unknown Error"),t),Object(l.a)({error:t,config:e.config,fetchedAt:h()(),nodes:[]})}))},e.watchStations=function(t,e,n){var o=this;return void 0===t&&(t=Object(l.a)(!0)),void 0===e&&(e=300),Object(v.a)(Object(d.a)(0,1e3*e),t).pipe(Object(O.a)(100),Object(g.a)(function(){return o.getStations(n)}))},e.debug=function(t){if(this.verboseOutput){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];n.length?console.log(t,n):console.log(t)}},t}(),A=n(328);n.d(e,"withQueryParams",function(){return F}),n.d(e,"withPosition",function(){return L}),n.d(e,"withStations",function(){return J}),Object(o.setObservableConfig)({fromESObservable:r.a});var F=Object(o.withProps)(function(){return{params:(t=new Map,new URLSearchParams(window.location.search).forEach(function(e,n){t.set(n.toLowerCase(),e)}),t)};var t});function L(t){void 0===t&&(t={enableHighAccuracy:!0});var e=new i.a(function(e){navigator.geolocation.watchPosition(function(t){e.next(t)},function(t){e.error({error:t})},t)});return Object(o.mapPropsStream)(function(t){return Object(a.a)(e.pipe(Object(s.a)(void 0)),t,function(t,e){return console.log("[position]",t,e),Object.assign({},e,{position:t})})})}function J(t){void 0===t&&(t="vancouver");var e=new A.Subject;return Object(o.mapPropsStream)(function(n){var o=n.pipe(Object(c.a)(function(t){var e=t.params;return Boolean(e)}),Object(u.a)(function(e){var n=e.params;return{debug:Boolean(n.get("debug")),source:n.get("source")||(n.get("test")?"test":t)}}),Object(f.a)(function(t,e){return t.debug===e.debug&&t.source===e.source}),Object(g.a)(function(t){var n=t.debug,o=t.source;return console.log("fetch",{source:o,debug:n}),P.create(o,{debug:n}).watchStations(e)}));return Object(a.a)(o,n,function(t,n){return console.log("[stations]",t,n),Object.assign({},n,{stations:t,reload:function(){console.log("reload"),e.next()}})})})}}}]);
//# sourceMappingURL=component---src-pages-components-index-page-decorators-ts-1562222d6d033840a5d0.js.map